node {
  
   def commit_id
   stage('Preparation') {
     checkout scm
     sh "git rev-parse --short HEAD > .git/commit-id"    

     commit_id = readFile('.git/commit-id').trim()
   }

   stage('docker build/push') {
        sh  "/usr/local/bin/docker/docker --version"
        sh  "/usr/local/bin/docker/docker build -t finance/finance_front_dev${commit_id}  -f Dockerfile.dev  ."
   }

   stage('Run On dev server'){
    sh " /usr/local/bin/docker/docker stop finance_front_dev || true && /usr/local/bin/docker/docker rm finance_front_dev || true  "
    sh  "/usr/local/bin/docker/docker run -d --name finance_front_dev --restart always -p 6201:6201 finance/finance_front_dev${commit_id}  "
   }


}
